Notes on generating the atmsrf file for a new grid

--------------------------------------------------------------------------------
build notes - don't use env_mach_specific

  cd components/eam/tools/mkatmsrffile
  
  ${e3sm_root}/cime/CIME/scripts/configure && source .env_mach_specific.sh

  env NETCDF_ROOT=$NETCDF_DIR FC=ifort make

--------------------------------------------------------------------------------
Create a grid file

  NE=30
  GenerateCSMesh --alt --res ${NE} --file ne${NE}.g
  GenerateVolumetricMesh --in ne${NE}.g --out ne${NE}pg2.g --np 2 --uniform
  ConvertExodusToSCRIP --in ne${NE}pg2.g  --out ne${NE}pg2_scrip.nc

--------------------------------------------------------------------------------
make sure imask variable is an integer

  FILE=ne16pg3_scrip.nc  ; ncap2 --ovr  -s 'grid_imask=int(grid_imask)' $FILE $FILE

#-------------------------------------------------------------------------------
Create a mapping file

  # old method
  # ncremap -a tempest   --src_grd=/project/projectdirs/e3sm/mapping/grids/1x1d.nc --dst_grd=/global/homes/w/whannah/E3SM/data_grid/ne30pg3_scrip.nc   -m /global/cscratch1/sd/whannah/e3sm_scratch/init_files//atmsrf_map_1x1_to_ne30pg3_mono.nc   -W '--in_type fv --in_np 2 --out_type fv --out_np 2 --out_format Classic'

NE=60

e3sm_root=/global/homes/w/whannah/E3SM/E3SM_SRC4
cd ${e3sm_root}/components/eam/tools/mkatmsrffile

HICCUP_ROOT=/global/cfs/projectdirs/m3312/whannah/HICCUP
DATA_FILE_ROOT=${HICCUP_ROOT}/files_drydep
GRID_FILE_ROOT=${HICCUP_ROOT}/files_grid
MAP_FILE_ROOT=${HICCUP_ROOT}/files_map

INPUTDATA_ROOT=/global/cfs/cdirs/e3sm/inputdata

SRC_GRID=/global/cfs/cdirs/e3sm/mapping/grids/1x1d.nc
DST_GRID=${GRID_FILE_ROOT}/scrip_ne${NE}pg2.nc
MAP_FILE=${MAP_FILE_ROOT}/map_1x1_to_ne${NE}pg2_traave.20240313.nc

# ncremap -5 -a fv2fv_flx --src_grd=${SRC_GRID} --dst_grd=${DST_GRID} --map_file=${MAP_FILE}

#-------------------------------------------------------------------------------

cat <<EOF > nml_atmsrf
&input
srfFileName =  '${SRC_GRID}'
atmFileName = '${DST_GRID}'
landFileName = '${INPUTDATA_ROOT}/atm/cam/chem/trop_mozart/dvel/regrid_vegetation.nc' 
soilwFileName = '${INPUTDATA_ROOT}/atm/cam/chem/trop_mozart/dvel/clim_soilw.nc'
srf2atmFmapname = '${MAP_FILE}'
outputFileName = '${DATA_FILE_ROOT}/atmsrf_ne${NE}pg2_20240313.nc'
/
EOF

# Generate teh new dry deposition file
./mkatmsrffile
